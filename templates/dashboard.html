{% extends "base.html" %}

{% block title %}BikeMate{% endblock %} <!--Title-->

{% block content %} <!--Custom content goes inside these blocks-->

<div class="dashboard_message">
    {% if session.email %}
        <h1>Velkommen tilbage {{session.name}}</h1>
    {% endif %}
</div>

<div class="rewards_component"> <!--Later use db for this-->
    <h1>Dine belønninger</h1>
    <div class="rewards_content">
        {% if rewards %}
        <!--TODO: Håndter dette-->
        {% else %}
            <p>Ingen belønninger fundet</p>
        {% endif %}
    </div>
</div>
<section class="main_content">
    <div class="posts_component">
        <h1>Seneste opslag</h1>
        <div class="post_container" hx-get="/dashboard/posts">
            {% if user_posts %}
                {% for user_post in user_posts %}
                <div class="post">
                    <p>{{ session.name}}</p>
                    <p class="post_date">{{ user_post.created }}</p>
                    <p class="post_content">{{ user_post.content }}</p>
                    {% if user_post.image_path %}
                        <img src="/{{ user_post.image_path }}" alt="post image" class="post_image">
                    {% endif %}
                    <button class="delete_post_btn" hx-delete="/dashboard/{{ user_post.id }}" 
                        hx-target=".post"
                        hx-confirm="Er du sikker på at du vil slette opslaget?">
                    Slet opslag</button>
                </div>
                    <hr>
                {% endfor %}
            {% else %}
                <p>Du har ingen opslag</p>
            {% endif %}
        </div>
    </div>
    
    <div class="challenges_component">
        <h1>Dine udfordringer</h1>
        <div class="challenge_container">
            {% if challenges %}
                {% for challenge in challenges %}
                    <div class="challenge">
                        <h3>{{ challenge.name }}</h3>
                            <p>Oprettet: <i class="fa-solid fa-clock"></i> {{ challenge.created }}</p>
                            <p>Slutter {{ challenge.end_date }}</p>
                            <p>Emne: {{ challenge.topic }}</p>
                            <p>Deltagere: <i class="fa-solid fa-user-group"></i> {{ challenge.participants_count}}</p>
                    </div>
                {% endfor %}
            {% else %}
                <p>Du har ingen udfordringer</p>
            {% endif %}
        </div>
    </div>

    <div class="follows">
        <h1>Personer du følger</h1>
        <div class="follows_container">
            {% if follows %}
                {% for user in follows %}
                    <div class="follows_list">
                        <p class="person">{{ user.name }}</p>
                        <form 
                            hx-delete="/dashboard/unfollow/{{ user.id }}" 
                            hx-confirm="Er du sikker på at du vil fjerne {{ user.name }}"
                            hx-target=".follows_list">
                            <button class="unfollow_person">
                                Fjern
                            </button>
                        </form>
                    </div>
                {% endfor %}
            {% else %}
                <p>Du følger ikke nogen</p>
            {% endif %}
        </div>
    </div>
</section>

{% endblock %}